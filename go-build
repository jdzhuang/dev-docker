#!/bin/sh

_pwd="$PWD"
_name="$(basename $_pwd)"
if [[ "$1" != "" ]]; then _name="$1"; fi
_go_ver="1.8.4" #1.9.1-alpine3.6
_img="golang:${_go_ver}-alpine3.6"
if [[ "$2" != "" ]]; then _go_ver="$2"; fi
_path="/go/src/$_name"

_docker="sudo docker run --rm -v "$_pwd":"$_path" -w "$_path" $_img"
if [[ $(uname -r|grep Microsoft|wc -l) -gt 0 ]]; then 
	echo "building '$_name' "
	_docker="";
else
	echo "building '$_name' ...with go:$_go_ver"
	echo "$_docker"
fi
mkdir -p $_pwd/build
$_docker go build -v -o "$_path/build/${_name}.bin"

