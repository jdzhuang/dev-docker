#!/bin/bash

_pwd="$PWD"
_name="$(basename $_pwd)"
if [[ "$1" != "" ]]; then _name="$1"; fi
_go_ver="1.8.4" #1.9.1-alpine3.6
_img="golang:${_go_ver}-alpine3.6"
if [[ "$2" != "" ]]; then _go_ver="$2"; fi
_path="/go/src/$_name"

mkdir -p $_pwd/build
_docker_bin="sudo docker"
if [[ $(uname -r|grep Microsoft|wc -l) -gt 0 ]]; then 
	echo "building '$_name' within Microsoft	"
	if [[ $(echo "$_pwd"|grep -E "^/mnt/"|wc -l) -lt 1 ]]; then
		echo "plz. put your project on /mnt/X/... so that it could be accessed by DOCKER_ON_WINDOWS.">&2
		exit
	fi
	_docker_bin="docker.exe";
	_pwd=$(echo "$_pwd"|sed "s#/mnt/\([^/]*\)/\(.*\)#\1:/\2#g")
else
	echo "building '$_name' ...with go:$_go_ver"
	echo "$_docker"
fi
_docker_var="run --rm -v "$_pwd":"$_path" -w "$_path" $_img"
echo $_docker_bin $_docker_var go build -v -o "./build/${_name}.bin"
$_docker_bin $_docker_var go build -v -o "./build/${_name}.bin"

